### IO模型

- 系统背景

- 5中IO模型

- 





#### 系统背景

##### 设备数据交互方式

进程内的数据与物理设备间的数据交互过程如下

```
# 读数据
物理设备 -> [内核空间buffer] -> [用户空间buffer] -> 进程
# 写数据
进程 -> [用户空间buffer] -> [内核空间buffer] -> 物理设备 
```

需要说明的问题：

- 为什么需要buffer？
  
  使用Buffer能够以数据块的方式将数据加载到内存中，减少磁盘的IO次数。

- 为什么不是用户空间buffer直接与物理设备交互？
  
  因为读写设备上的数据都需要使用系统调用，进行系统调用时需要把用户空间的数据拷贝到内核空间，然后操作系统再切换CPU到特权模式进行设备操作。

- 哪些拷贝过程可能需要CPU参与
  
  内核空间buffer和用户空间buffer之间的拷贝需要CPU参与。
  
  但内核空间buffer与设备直接的拷贝可以采用DMA的方式减少CPU使用。

- 哪些过程出现用户态内核态切换
  
  内核空间buffer和用户空间buffer之间的拷贝会出现用户态内核态切换。

- 

##### 数据交互过程中的概念

阻塞IO与非阻塞IO对比：<br>

简单来说就是在DMA拷贝数据的阶段，系统调用是否直接返回。因为DMA无需CPU介入。

- 阻塞IO：从开始发起IO操作开始就阻塞，直到IO完成才返回

- 非阻塞IO：发起IO操作时，如果数据在内核空间中就阻塞进程并拷贝数据到内核空间。如果需要等待则直接通过异常返回告知调用方数据未就绪。

同步IO与异步IO对比：<br>

简单来说就是数据在用户空间和内核空间之间拷贝是否需要使用调用方的CPU。

- 同步IO：当数据在需要拷贝是，内核抢占当前进程CPU进行拷贝，当前进程阻塞。

- 异步IO：内核创建独立的线程拷贝数据，当前进程继续处理数据。



#### 5种IO模型



![](E:\Notebook\Personal\NoteBook\img\22e9116dd160c8b8fb807da4d9d5393551a5e19e.png)





参考文章：

1. [五种IO模型透彻分析 - 骏马金龙 - 博客园](https://www.cnblogs.com/f-ck-need-u/p/7624733.html)
2. [深入理解 Linux的I/O 系统|缓存|buffer|磁盘|系统调用|linux](https://xw.qq.com/cmsid/20211216A01H5600)
