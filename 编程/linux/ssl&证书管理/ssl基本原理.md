### ssl基本原理

- 公钥体系
  
  - PKI架构
    
    - 主体身份授信过程
    
    - 信任链构成

- 证书结构

#### 公钥体系

公钥体系是实现SSL安全通信的基础，用于解决通信双方相互认证的基础。**用于信息接收方验证消息发送方的身份**<br>

**证书=公钥 + 主体身份信息 + CA数字签名：（证书等价于CA以文件的形式发送的SSL信息）**

- 公钥：解密私钥发送的消息，**解决身份验证问题，即是不是ta**

- 主体身份信息：用于接收方核对，**解决身份信息获取问题，即ta是谁的问题**

- CA数字签名：是CA使用私钥加密后的数据摘要，使用CA证书中的公钥解密出的摘要和当前消息的摘要做对比，**解决上面两项信息是否可信的问题，即是不是真的**

##### PKI架构

基本假设：

- 由于网络环境复杂，通信双方相互直接不是直接可信

- 通信双方主体都必须保管各自的私钥，用于对发送的信息进行加密数字签名和对使用公钥加密的

- 对证书的信任传递是通过`CA -> Sub CA -> ... -> cert `进行传递。

###### 主体身份授信过程

1. 生成公钥私钥密钥对。

2. 把公钥加上身份信息生成，证书签名请求发给CA签名

3. CA验证后签名生成证书。

![](E:\Notebook\Personal\NoteBook\img\8496a829fa3c5e41b4724b4d1c83d6e738bffbbb.png)

###### 信任链构成

- 证书可信的条件：证书对应的 直接CA可信，**因为有数字签名保证证书是由证书的直接CA颁发的**。
- CA可信条件：本身就是根CA，或者父级CA可信。

信任链相关信息：

- 数字证书上的`ca(签发者)`字段

#### 证书结构

##### 主体信息字段

这些字段信息主要包含主体的相关信息，用于接收信息方进行身份验证。不同的应用对这些信息有不同的用法。<br>

常见字段：

- CN：common name，用于描述主体是谁。在https请求中作为网站域名的认证。在K8S中作为用户名。

- O：Organization，用于描述主体所属组织，在k8s中作为用户的group。

- SAN: 主体可选名，主要用于描述网站的可选域名

证书相关信息字段：

- key usage：秘钥用法，描述证书的作用
  
  - `Certificate Sign`：证书签发，通常是CA证书的作用
  
  - `key encipherment`：数据加密
  
  - `server`或者`server auth`：用于服务端身份验证
  
  - `client`或者`client auth`：用于客户端身份验证
