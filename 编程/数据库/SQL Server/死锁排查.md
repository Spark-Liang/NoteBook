###### 在锁查看中常用的 sql

```sql
-- 查看当前锁视图
SELECT * FROM sys.dm_tran_locks;

-- 查看当前活动sql
SELECT  
  [session_id],
  [blocking_session_id] AS '正在阻塞其他会话的会话ID',
  DB_NAME([database_id]) AS '数据库名称',
  [request_id],
  [cpu_time],
  [start_time] AS '开始时间',
  [status] AS '状态',
  [command] AS '命令',
  dest.[text] AS 'sql语句', 
  [reads] AS '物理读次数',
  [writes] AS '写次数',
  [logical_reads] AS '逻辑读次数',
  [row_count] AS '返回结果行数',
  [wait_type] AS '等待资源类型',
  [wait_time] AS '等待时间',
  [wait_resource] AS '等待的资源'
  FROM sys.[dm_exec_requests] AS der 
  CROSS APPLY 
  sys.[dm_exec_sql_text](der.[sql_handle]) AS dest 
  WHERE 1=1 
   ORDER BY [session_id] DESC 
;

-- 查看当前活动的session
select * from sys.dm_exec_sessions
```



###### transaction 与 DDL

在一个session中使用ddl不会造成事务提交，而是由于事务的原因会持有某些和ddl执行相关的资源的锁。当只有我们去commit 或者 rollback transaction 时才会把这些持有的资源释放。 另外**rollback transaction 会把ddl的执行结果也rollback。**
